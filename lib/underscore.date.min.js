// Underscore.date
//
// (c) 2011 Tim Wood
// Underscore.date is freely distributable under the terms of the MIT license.
//
// Version 0.3.2

(function(a,b,c){function u(a){var b=Math.abs(a)/1e3,c=b/60,d=c/60,e=d/24,f=e/365;return b<45&&r("s",~~b)||b<90&&r("m")||c<45&&r("mm",~~c)||c<90&&r("h")||d<24&&r("hh",~~d)||d<48&&r("d")||e<25&&r("dd",~~e)||e<45&&r("M")||e<350&&r("MM",~~((e+15)/30))||f<2&&r("y")||r("yy",~~f)}function t(a,b){return q(a)-q(b)}function s(a){this.date=p(a);return this}function r(a,b){return k[a].replace(/%d/i,b||1)}function q(a){return isNaN(a)?p(a).getTime():a}function p(d){return d===c?new a:d instanceof s?d.date:b.isDate(d)?d:b.isArray(d)&&d.length>2?o(d):new a(d)}function o(b){return new a(b[0],b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0)}function n(b,c,d){var e=b.date,f=(c.ms||0)+(c.s||0)*1e3+(c.m||0)*6e4+(c.h||0)*36e5+(c.d||0)*864e5+(c.w||0)*6048e5,g=(c.M||0)+(c.y||0)*12,h;f&&e.setMilliseconds(e.getMilliseconds()+f*d),g&&(h=e.getDate(),e.setDate(1),e.setMonth(e.getMonth()+g*d),e.setDate(Math.min((new a(e.getFullYear(),e.getMonth()+1,0)).getDate(),h)));return b}function m(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function d(a){return a.slice(0,3)}var e=this,f,g=["January","February","March","April","May","June","July","August","September","October","November","December"],h=b.map(g,d),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=b.map(i,d),k={future:"in %s",past:"%s ago",s:"seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},l=function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"};s.prototype.format=function(b){function t(b){var c,r;switch(b){case"M":return d+1;case"Mo":return d+1+l(d+1);case"MM":return m(d+1,2);case"MMM":return h[d];case"MMMM":return g[d];case"D":return e;case"Do":return e+l(e);case"DD":return m(e,2);case"DDD":c=new a(f,d,e),r=new a(f,0,1);return~~((c-r)/864e5+1.5);case"DDDo":c=t("DDD");return c+l(c);case"DDDD":return m(t("DDD"),3);case"d":return k;case"do":return k+l(k);case"ddd":return j[k];case"dddd":return i[k];case"w":c=new a(f,d,e-k+5),r=new a(c.getFullYear(),0,4);return~~((c-r)/864e5/7+1.5);case"wo":c=t("w");return c+l(c);case"ww":return m(t("w"),2);case"YY":return(f+"").slice(-2);case"YYYY":return f;case"a":return n>11?"pm":"am";case"A":return n>11?"PM":"AM";case"H":return n;case"HH":return m(n,2);case"h":return n%12||12;case"hh":return m(n%12||12,2);case"m":return o;case"mm":return m(o,2);case"s":return p;case"ss":return m(p,2);case"z":return t("zz").replace(s,"");case"zz":c=q.indexOf("(");if(c>-1)return q.slice(c+1,q.indexOf(")"));return q.slice(q.indexOf(":")).replace(s,"");default:return b.replace("\\","")}}var c=this.date,d=c.getMonth(),e=c.getDate(),f=c.getFullYear(),k=c.getDay(),n=c.getHours(),o=c.getMinutes(),p=c.getSeconds(),q=c.toString(),r=/(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|zz?)/g,s=/[^A-Z]/g;return b.replace(r,t)},s.prototype.add=function(a){return n(this,a,1)},s.prototype.subtract=function(a){return n(this,a,-1)},s.prototype.customize=function(a){var c=a.ordinal;b.extend(i,a.weekdays),b.extend(j,a.weekdaysShort),b.extend(g,a.months),b.extend(h,a.monthsShort),b.extend(k,a.relativeTime),c&&b.isFunction(c)&&(l=c)},s.prototype.from=function(a,b,c){var d=t(this.date,a),e=d<0?k.past:k.future;return c?d:b?u(d):e.replace(/%s/i,u(d))},s.prototype.fromNow=function(a,c){return this.from(b.now(),a,c)},s.prototype.isLeapYear=function(){return b.isLeapYear(this.date.getFullYear())},f={date:function(a){return new s(a)},now:function(b){return b?(new a).getTime():f.date()},isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0}},b&&b.mixin&&b.mixin(f)})(Date,_)
